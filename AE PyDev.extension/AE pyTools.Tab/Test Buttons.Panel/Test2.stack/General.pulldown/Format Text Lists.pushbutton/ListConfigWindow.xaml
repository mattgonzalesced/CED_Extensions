<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Format TextNote Lists"
        Height="560"
        Width="1020"
        MinHeight="420"
        MinWidth="980"
        Background="#FFF6F6F6"
        Foreground="#222"
        WindowStartupLocation="CenterScreen">

  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

<!-- Header -->
<Border Grid.Row="0"
        CornerRadius="8"
        Padding="10"
        Background="White"
        BorderBrush="#DDD"
        BorderThickness="1">
  <StackPanel>
    <TextBlock FontSize="16"
               FontWeight="SemiBold"
               Text="Configure list recognition and replacement formatting"/>
    <TextBlock Margin="0,4,0,0"
               Foreground="#555"
               Text="Each row is a list level. Enable rows you need; disabled rows clear out and donâ€™t apply."/>
  </StackPanel>
</Border>

<!-- Options -->
<Border Grid.Row="1"
        Margin="0,10,0,10"
        CornerRadius="8"
        Padding="10"
        Background="White"
        BorderBrush="#DDD"
        BorderThickness="1">

  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto"/>
      <ColumnDefinition Width="18"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <StackPanel Grid.Column="0" Orientation="Vertical">

      <CheckBox x:Name="ChkSectionHeaders"
                Content="Enable Section Headers (spec mode; headers reset lists)"
                Margin="0,0,0,6"
                Focusable="False"/>

      <CheckBox x:Name="ChkOperateExisting"
                Content="Operate on existing text (do NOT rebuild/strip tokens)"
                Focusable="False"/>

    </StackPanel>

    <StackPanel Grid.Column="2" Orientation="Vertical">
      <TextBlock Foreground="#666"
                 Text="Section headers: 3.01 / 1.07 / 15100.02"/>
      <TextBlock Margin="0,4,0,0"
                 Foreground="#666"
                 TextWrapping="Wrap"
                 Text="Operate existing = do not re-parse numbering; use this when the TextNote is already formatted and you only want spacing or minor changes."/>
    </StackPanel>
  </Grid>
</Border>

    <!-- Main area: fixed-width grid + stretchy help -->
    <Grid Grid.Row="2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="760"/>
        <ColumnDefinition Width="12"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Data grid (no horizontal scroll; always fully visible) -->
      <Border Grid.Column="0" CornerRadius="8" Padding="8" Background="White" BorderBrush="#DDD" BorderThickness="1">
        <DataGrid x:Name="GridLevels"
                  ItemsSource="{Binding Levels}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserResizeRows="False"
                  CanUserReorderColumns="False"
                  HeadersVisibility="Column"
                  GridLinesVisibility="Horizontal"
                  RowHeaderWidth="0"
                  AlternationCount="2"
                  AlternatingRowBackground="#FFF3F3F3"
                  HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Auto"
                  SelectionUnit="FullRow"
                  SelectionMode="Single"
                  IsReadOnly="False">

          <DataGrid.Columns>

            <!-- Enabled FIRST -->
            <DataGridTemplateColumn Header="On" Width="45">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <CheckBox IsChecked="{Binding Enabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Checked="EnabledChanged"
                            Unchecked="EnabledChanged"
                            Focusable="False"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTextColumn Header="Lvl" Width="45" IsReadOnly="True"
                                Binding="{Binding LevelIndex}"/>

            <!-- Pattern ALWAYS visible -->
            <DataGridTemplateColumn Header="Pattern" Width="135">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <ComboBox ItemsSource="{Binding DataContext.PatternOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                            DisplayMemberPath="Display"
                            SelectedValuePath="Key"
                            SelectedValue="{Binding PatternKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            IsTextSearchEnabled="True"
                            VerticalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <!-- Token ALWAYS visible -->
            <DataGridTemplateColumn Header="Token" Width="85">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <ComboBox ItemsSource="{Binding DataContext.TokenOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                            DisplayMemberPath="Display"
                            SelectedValuePath="Key"
                            SelectedValue="{Binding TokenKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            IsTextSearchEnabled="True"
                            VerticalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <!-- Revit List ALWAYS visible -->
            <DataGridTemplateColumn Header="Revit List" Width="150">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <ComboBox ItemsSource="{Binding DataContext.RevitListOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                            DisplayMemberPath="Display"
                            SelectedValuePath="Key"
                            SelectedValue="{Binding RevitListKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            IsTextSearchEnabled="True"
                            VerticalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <!-- Indent ALWAYS visible (auto-normalizes on LostFocus) -->
            <DataGridTemplateColumn Header="Indent" Width="60">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBox Text="{Binding Indent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                           IsEnabled="{Binding Enabled}"
                           LostFocus="IndentLostFocus"
                           VerticalContentAlignment="Center"
                           Padding="4,1,4,1"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <!-- Blank flags -->
            <DataGridTemplateColumn Header="Before" Width="60">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <CheckBox IsChecked="{Binding BlankBefore, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTemplateColumn Header="Between" Width="70">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <CheckBox IsChecked="{Binding BlankBetween, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTemplateColumn Header="After" Width="60">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <CheckBox IsChecked="{Binding BlankAfter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding Enabled}"
                            Focusable="False"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

          </DataGrid.Columns>
        </DataGrid>
      </Border>

      <!-- Help panel (this is the ONLY thing that stretches) -->
      <Border Grid.Column="2" CornerRadius="8" Padding="10" Background="White" BorderBrush="#DDD" BorderThickness="1">
        <StackPanel>
          <TextBlock FontSize="14" FontWeight="SemiBold" Text="Help"/>
          <TextBlock Margin="0,6,0,10" Foreground="#555" TextWrapping="Wrap"
                     Text="Enable levels you want. Indents auto-correct to ensure nesting (no accidental flattening)."/>

          <TextBlock FontWeight="SemiBold" Text="Pattern"/>
          <TextBlock Margin="0,2,0,8" Foreground="#555" TextWrapping="Wrap"
                     Text="NUMERIC=1.  DECIMAL=1.1  TRIDECIMAL=1.1.1  NUMDOT=1.A.  UPPER=A.  LOWER=a."/>

          <TextBlock FontWeight="SemiBold" Text="Token"/>
          <TextBlock Margin="0,2,0,8" Foreground="#555" TextWrapping="Wrap"
                     Text="Controls the separator after the leading marker: DOT (1.), RPAREN (1)), DASH (1 -)."/>

          <TextBlock FontWeight="SemiBold" Text="Revit List"/>
          <TextBlock Margin="0,2,0,8" Foreground="#555" TextWrapping="Wrap"
                     Text="Choose what Revit should display for that level (numbers, letters, bullets)."/>

          <TextBlock FontWeight="SemiBold" Text="Indent"/>
          <TextBlock Margin="0,2,0,8" Foreground="#555" TextWrapping="Wrap"
                     Text="Graphical only. If you change Level 1 indent, lower levels auto-increment. Duplicate indents auto-fix." />

          <TextBlock FontWeight="SemiBold" Text="Blank Between"/>
          <TextBlock Margin="0,2,0,0" Foreground="#555" TextWrapping="Wrap"
                     Text="Inserts a soft return (\v) between consecutive list items for spacing."/>
        </StackPanel>
      </Border>
    </Grid>

    <!-- Buttons -->
    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button x:Name="BtnCancel" Width="90" Height="30" Margin="0,0,8,0" Content="Cancel"/>
      <Button x:Name="BtnRun" Width="140" Height="30" Content="Run Format"/>
    </StackPanel>

  </Grid>
</Window>

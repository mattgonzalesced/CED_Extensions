Update Vector – Code Explained
==============================

Purpose
-------
`Update Vector` refreshes the geometric portion of an equipment definition
without touching its parameter/tag metadata. Designers use it after they move a
placed configuration in the model. The command measures the new offsets,
updates Extensible Storage, and (optionally) propagates the change to every
other instance carrying the same Linked Element Definition ID.

Execution Flow
--------------
1. **Target Resolution** – We read the selected element’s Element_Linker
   payload, parse the LED/SET identifiers, and fetch the matching entry from the
   active YAML (`load_active_yaml_data`). The payload includes a `Parent Rotation
   (deg)` field (captured by Select Parent Element) so we can re-create the
   parent’s coordinate system exactly.
2. **Offset Math** – The element’s current world location is compared to the
   stored base point. By rotating the delta vector back by the parent rotation
   we obtain new `x_inches`, `y_inches`, `z_inches` offsets. The rotation offset
   becomes `elem_rotation - parent_rotation`, which keeps the child’s twist
   relative to its parent.
3. **YAML + Metadata Update** – The linked element definition receives the new
   offset numbers. We call `save_active_yaml_data` so Extensible Storage records
   the edit, then we rebuild the Element_Linker text on the actual family
   instance (with the refreshed parent rotation) to keep the model in sync.
4. **Propagate to Similar (Optional)** – `_collect_similar_elements` locates
   every other instance referencing the same LED. For each element we compute
   its own base point using the parent rotation stored in its payload, move/rotate
   it by the same vector, and rewrite its Element_Linker data. This keeps crews
   from re-running the placer when only minor tweaks were made.

Notable Details
---------------
* Tags hosted on the element are reprojected via `_update_tag_yaml_offsets`, so
  annotation stays aligned with the new geometry.
* All edits participate in Revit’s undo stack because we wrap metadata writes in
  transactions and Extensible Storage history entries.
* When YAML verification detects that offsets failed to persist, the tool warns
  the user and suggests rerunning so no stale data remains.

In short, Update Vector is the geometric maintenance tool: it keeps YAML and
Element_Linker metadata aligned whenever a crew nudges the installed equipment.

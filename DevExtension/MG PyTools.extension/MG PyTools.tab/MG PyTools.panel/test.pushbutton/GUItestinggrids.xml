from pyrevit import forms

# WPF layout with DataGrid and ComboBox
layout = """
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Parameter Set Selector"
        Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Window.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF1E88E5" Offset="0.0" />
            <GradientStop Color="#FF64B5F6" Offset="1.0" />
        </LinearGradientBrush>
    </Window.Background>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" Text="Select a Parameter Set" FontSize="20" FontWeight="Bold" Foreground="White" 
                   HorizontalAlignment="Center" Margin="0,0,0,10" />

        <!-- ComboBox and DataGrid -->
        <StackPanel Grid.Row="1" VerticalAlignment="Top" Margin="20">
            <TextBlock Text="Parameter Sets:" FontSize="16" Foreground="White" Margin="0,0,0,10" />
            <ComboBox Name="parameterDropdown" Width="200" Margin="0,0,0,10" />
            <TextBlock Text="Details in Set:" FontSize="16" Foreground="White" Margin="0,10,0,5" />
            <DataGrid Name="detailsGrid" AutoGenerateColumns="False" Height="300" Background="White" IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Element 1" Binding="{Binding Element1}" Width="*" />
                    <DataGridTextColumn Header="Element 2" Binding="{Binding Element2}" Width="*" />
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>

        <!-- Confirm Button -->
        <Button Grid.Row="2" Name="okButton" Content="Confirm" FontSize="16" FontWeight="Bold"
                HorizontalAlignment="Center" Width="120" Background="#FF64B5F6" Foreground="White"
                Margin="0,10" />
    </Grid>
</Window>
"""

# Python code to handle data and events
class ParameterSetSelector(forms.WPFWindow):
    def __init__(self):
        super(ParameterSetSelector, self).__init__(layout, literal_string=True)
        self.okButton.Click += self.on_done_clicked  # Connect "Confirm" button
        self.parameterDropdown.SelectionChanged += self.on_parameter_selected  # Handle ComboBox selection

        # Parameter sets data
        self.parameter_sets = {
            "One Line Diagram": [
                {"Element1": "Panel Name", "Element2": "Name"},
                {"Element1": "Voltage", "Element2": "Voltage"},
                {"Element1": "ISC", "Element2": "ISC"},
                {"Element1": "VD", "Element2": "VD"},
            ],
            "Load Calculation": [
                {"Element1": "Load Name", "Element2": "Value"},
                {"Element1": "Type", "Element2": "Category"},
                {"Element1": "Demand", "Element2": "Total Load"},
            ],
        }

        # Populate ComboBox with parameter set names
        self.parameterDropdown.ItemsSource = list(self.parameter_sets.keys())
        self.detailsGrid.ItemsSource = []  # Initialize DataGrid as empty

    def on_parameter_selected(self, sender, args):
        # Get the selected parameter set
        selected_set_name = self.parameterDropdown.SelectedItem
        if selected_set_name:
            # Update DataGrid with the selected parameter set's data
            self.detailsGrid.ItemsSource = self.parameter_sets[selected_set_name]

    def on_done_clicked(self, sender, args):
        # Handle confirm button
        selected_set_name = self.parameterDropdown.SelectedItem
        if selected_set_name:
            forms.alert("You selected: {0}".format(selected_set_name), title="Selection Complete")
        else:
            forms.alert("No parameter set selected.", title="No Selection")
        self.Close()

# Show the custom form
try:
    selector = ParameterSetSelector()  # Create the parameter set selector
    selector.show_dialog()  # Open the window
except Exception as e:
    # In case of critical error, show the error message
    forms.alert("Critical error: {0}".format(str(e)), title="Error")
